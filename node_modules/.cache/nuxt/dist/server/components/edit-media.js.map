{"version":3,"file":"components/edit-media.js","sources":["webpack:///./components/editMedia.vue?b206","webpack:///./components/editMedia.vue","webpack:///./components/editMedia.vue?a563","webpack:///./components/editMedia.vue?6b12"],"sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_vm._ssrNode(\"<div class=\\\"form-bloc form-bloc-list mt-9\\\">\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"col w-full\\\">\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"col-content\\\">\",\"</div>\",[_vm._ssrNode(\"<label for=\\\"AddFile\\\" id=\\\"LAddFile\\\" class=\\\"mb-3 border-b border-mainColor cursor-pointer\\\"><div class=\\\"pb-2\\\">Medias</div> <div class=\\\"flex-1 text-right flex justify-end add highlight\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" fill=\\\"none\\\" viewBox=\\\"0 0 24 24\\\" stroke=\\\"currentColor\\\" class=\\\"bi\\\"><path stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" stroke-width=\\\"2\\\" d=\\\"M12 4v16m8-8H4\\\"></path></svg></div></label> \"),_c('draggable',{staticClass:\"media-grid w-full\",attrs:{\"list\":_vm.medias,\"tag\":\"div\",\"draggable\":\".item\"},on:{\"end\":_vm.onEndPosition}},_vm._l((_vm.medias),function(media,indexMedia){return _c('div',{staticClass:\"relative item cursor-pointer\",domProps:{\"innerHTML\":_vm._s(_vm.getModeMedia(media.fichier))},on:{\"click\":function($event){_vm.displayMedia(media.id_document);_vm.hideErreur();}}})}),0)],2)])]),_vm._ssrNode(\" <div id=\\\"defaultModalMedia\\\" tabindex=\\\"1\\\" class=\\\"modalZone hidden overflow-y-auto overflow-x-hidden bg-mainBg/50 flex fixed right-0 left-0 top-4 z-50 justify-center items-center md:h-full md:inset-0\\\"><div class=\\\"relative px-6 w-full max-w-2xl h-full md:h-auto\\\"><div class=\\\"relative bg-mainBg p-6 border border-activeColor\\\"><div class=\\\"flex justify-between items-start border-b border-mainColor\\\"><h1>Média</h1> <div data-modal-toggle=\\\"defaultModalMedia\\\" class=\\\"bg-transparent ml-auto inline-flex items-center highlight\\\"><svg fill=\\\"currentColor\\\" viewBox=\\\"0 0 20 20\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"big cursor-pointer\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\\\" clip-rule=\\\"evenodd\\\"></path></svg></div></div> <div><div class=\\\"form-container w-full border-0 p-0\\\"><form method=\\\"post\\\" autocomplete=\\\"off\\\"><div class=\\\"form-bloc mt-9\\\"><div class=\\\"col w-full\\\"><div class=\\\"col-content\\\"><div><div\"+(_vm._ssrClass(\"justify-between align-center\",_vm.flexIsFile))+\"><div class=\\\"previewMediaUpload pb-1 flex items-center  justify-center\\\"><div class=\\\"text-sm w-28\\\">\"+(_vm._s(_vm.previewMedia))+\"</div></div></div> <label class=\\\"uploadZone-media bt-upload required_field\\\"><span class=\\\"leading-normal\\\">choisir un média</span> <input type=\\\"file\\\" id=\\\"file_media\\\"\"+(_vm._ssrAttr(\"accept\",_vm.accept_file))+\" class=\\\"hidden\\\"></label> <div class=\\\"progress progress-media hidden\\\"><div class=\\\"progress-title-media\\\">\"+_vm._ssrEscape(_vm._s(_vm.uploadPercentageMedia)+\"%\")+\"</div> <div class=\\\"progress-stop-media\\\">stop</div> <div class=\\\"progress-bar-media\\\"\"+(_vm._ssrStyle(null,{ width: _vm.uploadPercentageMedia + '%' }, null))+\"></div></div></div></div></div></div> <div class=\\\"form-bloc\\\"><div class=\\\"col w-full\\\"><div class=\\\"col-content\\\"><label for=\\\"legende_media\\\" id=\\\"Llegende_media\\\">Légende</label> <textarea name=\\\"legende_media\\\" id=\\\"legende_media\\\">\"+_vm._ssrEscape(_vm._s(_vm.legende_media))+\"</textarea></div></div></div> <div class=\\\"form-action\\\"><div><button type=\\\"button\\\">Annuler</button></div> <div\"+(_vm._ssrStyle(null,null, { display: (_vm.id_document != 0) ? '' : 'none' }))+\"><button type=\\\"button\\\" class=\\\"bt-delete\\\">Supprimer</button></div> <div><button type=\\\"submit\\\">Enregistrer</button></div></div></form></div></div></div></div></div>\")],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapGetters } from 'vuex';\nimport axios from 'axios';\nimport draggable from 'vuedraggable'\n\nexport default {\n  name: 'edit-media',\n  layout: 'edit',\n  middleware: 'auth',\n  components: {\n        draggable\n    }\n  ,\n  computed: {\n    ...mapGetters(['isAuthenticated', 'loggedInUser']),\n  },\n  created() {\n  }\n  ,\n  mounted() {\n\t  this.getMedias();\n  },\n  data() {\n    return {\n\t  url_server:this.$store.state.url_server,\n\t  accept_file:'.jpg,.jpeg,.png,.gif,.mp4,.mp3,.pdf',\n\t  value_file:'',\n\t  uploadPercentageMedia: 0,\n\t  previewMedia:'',\n\t  flexIsFile:'',\n\t  source:this.media_source,\n\t  id_parent : this.media_id_parent,\n\t  id_document: 0,\n\t  file_media:'',\n\t  value_file:'',\n\t  embed_media:'',\n\t  poster_media:'',\n\t  autoplay_media:'',\n\t  legende_media:'',\n\t  isNew_media:false,\n\t  medias:[],\n\t  media:'',\n\t  isShowLoadingMedias:true,\n\t  isShowNoResultMedias:false,\n    }\n  },\n  props: {\n  \tmedia_source: String,\n    media_id_parent: Number,\n  },\n\n  methods: {\n     getMedias: function()\n\t {\n\t\t console.log(\"p : \" + this.id_parent + \" / \" + this.source)\n       axios.get(this.url_server + \"/getMedias?id_parent=\" + this.id_parent + \"&source=\" + this.source)\n       .then(response => {\n\t       this.isShowLoadingMedias = false;\n\t       this.medias = response.data.resultat;\n\t       if (this.medias.length == 0) this.isShowNoResultMedias = true;\n\t   })\n\t   .catch(error => {\n\t\t   displayErreur('media loading error')\n      })\n    }\n    ,\n    getMedia: function()\n\t {\n       axios.get(this.url_server + \"/getMedia?id_document=\" + this.id_document)\n       .then(response => {\n\t       this.media = response.data.liste;\n\t\t   if (typeof this.media.fichier !== 'undefined') {\n\t\t       this.value_file = this.media.fichier;\n\t\t       this.legende_media = this.media.legende;\n\t\t       this.id_display = this.media.id_display;\n\t\t       this.display_end_line = this.media.display_end_line;\n\t\t       \n\t\t       this.getPreviewMedia();\n\t\t    }\n\t   })\n       .catch(error => {\n\t       this.id_document = 0;\n\t\t   displayErreur(\"media loading error\")\n      })\n    },\n    delMedia: function()\n\t {\n       axios.get(this.url_server + \"/delMedia?id_document=\" + this.id_document)\n       .then(response => {\n\t       this.displayMedia();\n\t\t   this.getMedias();\n\t   })\n       .catch(error => {\n\t       this.id_document = 0;\n\t\t   displayErreur(\"media deleting error\")\n      })\n    },\n\tsubmitMediaForm() {\n\t   clearRequiredModal();\n\t   this.hideErreur();\n\t   \n\t   if (this.id_document == 0) this.isNew_media = true;\n\t   let data = {\n\t\tid_document:this.id_document,\n\t\tid_parent: this.id_parent,\n\t\tsource: this.source,\n\t\tfichier: this.value_file,\n\t\tembed: this.embed_media,\n\t\tposter: this.poster_media,\n\t\tautoplay: this.autoplay_media,\n        legende: this.legende_media,\n        id_display: this.id_display,\n        display_end_line: this.display_end_line,\n        isNew: this.isNew_media,\n      };\n\n      var elems = document.querySelectorAll(\".modalZone .required_field\");\n\t  [].forEach.call(elems, function(el) {\n\t\t    if ((el.value == '')) {\n\t\t\t   el.classList.add(\"required\");\n\t\t\t}\n\t\t});\n\t\t\n\t\tif (this.value_file == '') {\n\t\t\tdocument.querySelectorAll(\".modalZone .uploadZone-media\")[0].classList.add(\"required\")\n\t\t}\n\t\t\n\t\t\n\t\tif(checkRequiredModal()) {\n\t\t\tdisplayErreur(\"The fields indicated are required\");\n\t\t}\n\t\telse {\n\t\t\tdisabledActionsModal();\n\t\t\t  axios.post(this.url_server + \"/addMedia\", data)\n\t\t\t   .then(response => {\n\t\t\t\t   this.id_document = response.data.id_document;\n\t\t\t\t   this.displayMedia();\n\t\t\t\t   this.getMedias();\n\t\t\t   })\n\t\t\t   .catch(error => {\n\t\t\t\t  enabledActionsModal();\n\t\t\t\t  displayErreur(\"Error adding media : \" + error)\n\t\t\t   })\n\t\t\t\n\t\t}\n       \n    },\n\thandleFileUploadMedia(e){\n\t\tthis.hideErreur();\n\t\t\n\t\tvar element = e.currentTarget;\n\t\tthis.fileId = element.id;\n\n\t\tthis.file_media = element.files[0];\n\t\tif (this.file_media != '') {\n\t\t\tthis.submitMedia();\n\t\t}\n\t}\n    ,\n    submitMedia(){\n\t  //this.uploadErreur = '';\n\t  this.uploadPercentageMedia = 0;\n\t  let formData = new FormData();\n\t  formData.append('file', this.file_media);\n\t  document.querySelectorAll(\".progress-media\")[0].classList.remove('hidden');\n\t  document.querySelectorAll(\".uploadZone-media\")[0].classList.add('hidden');\n\t  document.getElementById(\"file_media\").disabled = true;\n\t  axios.post(this.url_server + '/uploadFile',\n\t    formData,\n\t    {\n\t      headers: {\n\t          'Content-Type': 'multipart/form-data'\n\t      },\n\t      onUploadProgress: function( progressEvent ) {\n\t\t      var val = parseInt( Math.round((progressEvent.loaded*100) / progressEvent.total ));\n\t\t      document.querySelectorAll(\".progress-title-media\")[0].innerHTML = val + '%';\n\t\t\t  this.uploadPercentageMedia = val;\n\t      }.bind(this)\n\t    }\n\t  )\n\t  .then(response => {\n\t\t  \n\t\t  var isOptimize = response.data.isOptimize;\n\t\t  \n\t\t  document.querySelector('#file_media').value='';\n\t\t  this.value_file = response.data.optimizeFile[0];\n\n\t\t  \n\t\t  if (isOptimize) {\n\t\t\t  document.querySelectorAll(\".progress-title-media\")[0].innerHTML = 'media optimization...';\n\t\t\t  document.querySelectorAll(\".progress-stop-media\")[0].classList.add('hidden')\n\t\t\t  this.uploadPercentage = 0;\n\t\t\t  \n\t\t\t  setTimeout(function () { \n\t\t\t\t  axios.get(this.url_server + \"/optimizeFile?fichier=\" + this.value_file)\n\t\t\t       .then(response => {\n\t\t\t\t       document.querySelectorAll(\".progress-title-media\")[0].innerHTML = 'media optimization...';\n\t\t\t\t       this.getPreviewMedia()\n\t\t\t\t   })\n\t\t\t       .catch(error => displayErreur(\"Error during optimization\"))\n\t\t\t\t  \n\t\t\t  }.bind(this), 2000)\n\t\t\t  \n\t\t  }\n\t\t  else this.getPreviewMedia();\n\n\t\t  \n\t\t  \n\t\t  \n      })\n      .catch(err => {\n\t      if (typeof err.response.data.message === 'undefined') displayErreur(err.response.data.message)\n\t      else displayErreur(err.response.data.message)\n\t\t  document.querySelectorAll(\".progress-media\")[0].classList.add('hidden');\n\t\t  document.querySelectorAll(\".uploadZone-media\")[0].classList.remove('hidden');\n\t\t  document.getElementById(\"file_media\").disabled = false;\n      })\n\t}\n\t,\n\tgetModeMedia: function(file,isAdmin)\n    {\n\t    var ext = file.toLowerCase().split(\".\").pop();\n\t    var previewMedia = '';\n\t    switch(ext) {\n\t\t    case \"mp4\" : previewMedia = '<video width=\"100%\" height=\"auto\" controls><source src=\"/upload/' + file + '\" type=\"video/mp4\"></video>';\n\t\t    \t\t\t break;\n\t\t    case \"mp3\" : preview = '<audio controls><source src=\"/upload/' + file + '\" type=\"audio/mpeg\"></audio>';\n\t\t\t    \t\t\t break;\n\t\t    case \"jpg\" :\n\t\t    case \"jpeg\" :\n\t\t    case \"gif\" :\n\t\t    case \"png\" : previewMedia = '<img src=\"/upload/' + file + '\" />';\n\t\t    \t\t\t break;\n\t\t    default: previewMedia = '<a class=\"flex\" target=\"blank\" href=\"/upload/' + file + '\"><svg xmlns=\"http://www.w3.org/2000/svg\" class=\"pr-1\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" /><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" /></svg> preview file</a>';\n\t\t    \n\t\t    \t\t if (isAdmin) this.flexIsFile = 'flex ';\n\t    }\n\t    \n\t    return previewMedia;\n\t}\n\t,\n\tgetPreviewMedia: function()\n    {\n\t    document.querySelectorAll(\".progress-title-media\")[0].innerHTML = '';\n\t    document.querySelectorAll(\".progress-stop-media\")[0].classList.remove('hidden')\n\t\t\t  \n\t    document.querySelectorAll(\".progress-media\")[0].classList.add('hidden');\n\t\tdocument.querySelectorAll(\".uploadZone-media\")[0].classList.remove('hidden');\n\t\tdocument.getElementById(\"file_media\").disabled = false;\n\t\t  \n\t    var previewMedia = '';\n\t    var file = this.value_file;\n\t    if (this.value_file != '') {\n\t\t    this.previewMedia = this.getModeMedia(file,true);\n\t    }\n\t    \n    }\n    ,\n    displayMedia: function(id_document = 0)\n    {\n\t    \n\t    var _element = document.querySelectorAll(\"#defaultModalMedia\")[0]\n\t    \n\t    if (_element.classList.contains('hidden')) {\n\t\t    _element.classList.remove(\"hidden\");\n\t\t    _element.focus()\n\t\t    this.id_document = id_document;\n\t\t    if (this.id_document != 0) {\n\t\t\t\t\n\t\t\t\tthis.getMedia();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.value_file = '';\n\t\t\t\tthis.previewMedia = '';\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t\n\t\t\tthis.value_file = '';\n\t\t\tthis.embed_media = '';\n\t\t\tthis.poster_media = '';\n\t\t\tthis.autoplay_media = 0;\n\t        this.legende_media = '';\n\t        this.isNew_media = false;\n\t        this.id_display = 0;\n\t\t\tthis.display_end_line = 0;\n\t\t\t_element.classList.add(\"hidden\");\n\t\t\tthis.initForm();\n\t\t}\n    }\n\t,\n\thideErreur: function()\n    {\n\t    hideErreur();\n    }\n    ,\n    initForm: function(event)\n    {\n\t   if (typeof event !== 'undefined') {\n\t\t\tif (event.target.classList.contains(\"required\")) event.target.classList.remove(\"required\");\n       }\n       else {\n\t       clearRequiredModal();\n       }\n\t   enabledActionsModal();\n\t   hideErreur();\n    }\n    ,\n\tonEndPosition()\n\t{\n\t\tlet data = {\n\t\t\tid_parent: this.source,\n\t\t\tid_parent: this.id_parent,\n\t\t\tlist: this.medias,\n\t      };\n\t\t axios.post(this.url_server + \"/updateMediaPosition\", data)\n\t       .then(response => {\n\t\t       \n\t\t   })\n\t       .catch(error => displayErreur(\"error updating positions\"))\n\t}\n\n  }\n}\n","import mod from \"-!../node_modules/babel-loader/lib/index.js??ref--2-0!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./editMedia.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/babel-loader/lib/index.js??ref--2-0!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./editMedia.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./editMedia.vue?vue&type=template&id=7f2fed46&\"\nimport script from \"./editMedia.vue?vue&type=script&lang=js&\"\nexport * from \"./editMedia.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  \n}\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  null,\n  \"68eab8ec\"\n  \n)\n\nexport default component.exports"],"mappings":";;;;;;;;;;;AAAA;AACA;AACA;;;;;;;;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AAIA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApBA;AAsBA;AACA;AAAA;AACA;AACA;AAFA;AAKA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AARA;AAaA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAGA;AAEA;AAMA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAEA;AAZA;AACA;AAcA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;AAKA;AAKA;AACA;AA9QA;AA9CA;;ACrGA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}