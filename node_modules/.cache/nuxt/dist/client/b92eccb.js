(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{436:function(e,t,d){"use strict";d.r(t);d(26),d(19),d(20),d(37),d(25),d(38);var r=d(11),o=(d(267),d(74),d(47),d(126),d(9),d(62),d(27)),n=d(63),l=d.n(n),c=d(270);function m(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(object);e&&(d=d.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,d)}return t}var h={name:"edit-media",layout:"edit",middleware:"auth",components:{draggable:d.n(c).a},computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(o.b)(["isAuthenticated","loggedInUser"])),created:function(){},mounted:function(){this.getMedias()},data:function(){var e;return e={url_server:this.$store.state.url_server,accept_file:".jpg,.jpeg,.png,.gif,.mp4,.mp3,.pdf",value_file:"",uploadPercentageMedia:0,previewMedia:"",flexIsFile:"",source:this.media_source,id_parent:this.media_id_parent,id_document:0,file_media:""},Object(r.a)(e,"value_file",""),Object(r.a)(e,"embed_media",""),Object(r.a)(e,"poster_media",""),Object(r.a)(e,"autoplay_media",""),Object(r.a)(e,"legende_media",""),Object(r.a)(e,"isNew_media",!1),Object(r.a)(e,"medias",[]),Object(r.a)(e,"media",""),Object(r.a)(e,"isShowLoadingMedias",!0),Object(r.a)(e,"isShowNoResultMedias",!1),e},props:{media_source:String,media_id_parent:Number},methods:{getMedias:function(){var e=this;console.log("p : "+this.id_parent+" / "+this.source),l.a.get(this.url_server+"/getMedias?id_parent="+this.id_parent+"&source="+this.source).then((function(t){e.isShowLoadingMedias=!1,e.medias=t.data.resultat,0==e.medias.length&&(e.isShowNoResultMedias=!0)})).catch((function(e){displayErreur("media loading error")}))},getMedia:function(){var e=this;l.a.get(this.url_server+"/getMedia?id_document="+this.id_document).then((function(t){e.media=t.data.liste,void 0!==e.media.fichier&&(e.value_file=e.media.fichier,e.legende_media=e.media.legende,e.id_display=e.media.id_display,e.display_end_line=e.media.display_end_line,e.getPreviewMedia())})).catch((function(t){e.id_document=0,displayErreur("media loading error")}))},delMedia:function(){var e=this;l.a.get(this.url_server+"/delMedia?id_document="+this.id_document).then((function(t){e.displayMedia(),e.getMedias()})).catch((function(t){e.id_document=0,displayErreur("media deleting error")}))},submitMediaForm:function(){var e=this;clearRequiredModal(),this.hideErreur(),0==this.id_document&&(this.isNew_media=!0);var data={id_document:this.id_document,id_parent:this.id_parent,source:this.source,fichier:this.value_file,embed:this.embed_media,poster:this.poster_media,autoplay:this.autoplay_media,legende:this.legende_media,id_display:this.id_display,display_end_line:this.display_end_line,isNew:this.isNew_media},t=document.querySelectorAll(".modalZone .required_field");[].forEach.call(t,(function(e){""==e.value&&e.classList.add("required")})),""==this.value_file&&document.querySelectorAll(".modalZone .uploadZone-media")[0].classList.add("required"),checkRequiredModal()?displayErreur("The fields indicated are required"):(disabledActionsModal(),l.a.post(this.url_server+"/addMedia",data).then((function(t){e.id_document=t.data.id_document,e.displayMedia(),e.getMedias()})).catch((function(e){enabledActionsModal(),displayErreur("Error adding media : "+e)})))},handleFileUploadMedia:function(e){this.hideErreur();var element=e.currentTarget;this.fileId=element.id,this.file_media=element.files[0],""!=this.file_media&&this.submitMedia()},submitMedia:function(){var e=this;this.uploadPercentageMedia=0;var t=new FormData;t.append("file",this.file_media),document.querySelectorAll(".progress-media")[0].classList.remove("hidden"),document.querySelectorAll(".uploadZone-media")[0].classList.add("hidden"),document.getElementById("file_media").disabled=!0,l.a.post(this.url_server+"/uploadFile",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){var t=parseInt(Math.round(100*e.loaded/e.total));document.querySelectorAll(".progress-title-media")[0].innerHTML=t+"%",this.uploadPercentageMedia=t}.bind(this)}).then((function(t){var d=t.data.isOptimize;document.querySelector("#file_media").value="",e.value_file=t.data.optimizeFile[0],d?(document.querySelectorAll(".progress-title-media")[0].innerHTML="media optimization...",document.querySelectorAll(".progress-stop-media")[0].classList.add("hidden"),e.uploadPercentage=0,setTimeout(function(){var e=this;l.a.get(this.url_server+"/optimizeFile?fichier="+this.value_file).then((function(t){document.querySelectorAll(".progress-title-media")[0].innerHTML="media optimization...",e.getPreviewMedia()})).catch((function(e){return displayErreur("Error during optimization")}))}.bind(e),2e3)):e.getPreviewMedia()})).catch((function(e){e.response.data.message,displayErreur(e.response.data.message),document.querySelectorAll(".progress-media")[0].classList.add("hidden"),document.querySelectorAll(".uploadZone-media")[0].classList.remove("hidden"),document.getElementById("file_media").disabled=!1}))},getModeMedia:function(e,t){var d="";switch(e.toLowerCase().split(".").pop()){case"mp4":d='<video width="100%" height="auto" controls><source src="/upload/'+e+'" type="video/mp4"></video>';break;case"mp3":preview='<audio controls><source src="/upload/'+e+'" type="audio/mpeg"></audio>';break;case"jpg":case"jpeg":case"gif":case"png":d='<img src="/upload/'+e+'" />';break;default:d='<a class="flex" target="blank" href="/upload/'+e+'"><svg xmlns="http://www.w3.org/2000/svg" class="pr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg> preview file</a>',t&&(this.flexIsFile="flex ")}return d},getPreviewMedia:function(){document.querySelectorAll(".progress-title-media")[0].innerHTML="",document.querySelectorAll(".progress-stop-media")[0].classList.remove("hidden"),document.querySelectorAll(".progress-media")[0].classList.add("hidden"),document.querySelectorAll(".uploadZone-media")[0].classList.remove("hidden"),document.getElementById("file_media").disabled=!1;var e=this.value_file;""!=this.value_file&&(this.previewMedia=this.getModeMedia(e,!0))},displayMedia:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=document.querySelectorAll("#defaultModalMedia")[0];t.classList.contains("hidden")?(t.classList.remove("hidden"),t.focus(),this.id_document=e,0!=this.id_document?this.getMedia():(this.value_file="",this.previewMedia="")):(this.value_file="",this.embed_media="",this.poster_media="",this.autoplay_media=0,this.legende_media="",this.isNew_media=!1,this.id_display=0,this.display_end_line=0,t.classList.add("hidden"),this.initForm())},hideErreur:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){hideErreur()})),initForm:function(e){void 0!==e?e.target.classList.contains("required")&&e.target.classList.remove("required"):clearRequiredModal(),enabledActionsModal(),hideErreur()},onEndPosition:function(){var e,data=(e={id_parent:this.source},Object(r.a)(e,"id_parent",this.id_parent),Object(r.a)(e,"list",this.medias),e);l.a.post(this.url_server+"/updateMediaPosition",data).then((function(e){})).catch((function(e){return displayErreur("error updating positions")}))}}},f=h,v=d(10),component=Object(v.a)(f,(function(){var e=this,t=e.$createElement,d=e._self._c||t;return d("div",[d("div",{staticClass:"form-bloc form-bloc-list mt-9"},[d("div",{staticClass:"col w-full"},[d("div",{staticClass:"col-content"},[d("label",{staticClass:"mb-3 border-b border-mainColor cursor-pointer",attrs:{for:"AddFile",id:"LAddFile"},on:{click:function(t){e.displayMedia(0),e.hideErreur()}}},[d("div",{staticClass:"pb-2"},[e._v("Medias")]),e._v(" "),d("div",{staticClass:"flex-1 text-right flex justify-end add highlight"},[d("svg",{staticClass:"bi",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}},[d("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"}})])])]),e._v(" "),d("draggable",{staticClass:"media-grid w-full",attrs:{list:e.medias,tag:"div",draggable:".item"},on:{end:e.onEndPosition}},e._l(e.medias,(function(t,r){return d("div",{staticClass:"relative item cursor-pointer",domProps:{innerHTML:e._s(e.getModeMedia(t.fichier))},on:{click:function(d){e.displayMedia(t.id_document),e.hideErreur()}}})})),0)],1)])]),e._v(" "),d("div",{staticClass:"modalZone hidden overflow-y-auto overflow-x-hidden bg-mainBg/50 flex fixed right-0 left-0 top-4 z-50 justify-center items-center md:h-full md:inset-0",attrs:{id:"defaultModalMedia",tabindex:"1"},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.displayMedia(0)}}},[d("div",{staticClass:"relative px-6 w-full max-w-2xl h-full md:h-auto"},[d("div",{staticClass:"relative bg-mainBg p-6 border border-activeColor"},[d("div",{staticClass:"flex justify-between items-start border-b border-mainColor"},[d("h1",[e._v("Média")]),e._v(" "),d("div",{staticClass:"bg-transparent ml-auto inline-flex items-center highlight",attrs:{"data-modal-toggle":"defaultModalMedia"}},[d("svg",{staticClass:"big cursor-pointer",attrs:{fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},on:{click:function(t){return e.displayMedia()}}},[d("path",{attrs:{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"}})])])]),e._v(" "),d("div",[d("div",{staticClass:"form-container w-full border-0 p-0"},[d("form",{attrs:{method:"post",autocomplete:"off"},on:{submit:function(t){return t.preventDefault(),e.submitMediaForm.apply(null,arguments)}}},[d("div",{staticClass:"form-bloc mt-9"},[d("div",{staticClass:"col w-full"},[d("div",{staticClass:"col-content"},[d("div",[d("div",{staticClass:"justify-between align-center",class:e.flexIsFile},[d("div",{staticClass:"previewMediaUpload pb-1 flex items-center  justify-center"},[d("div",{staticClass:"text-sm w-28",domProps:{innerHTML:e._s(e.previewMedia)}})])]),e._v(" "),d("label",{staticClass:"uploadZone-media bt-upload required_field",on:{click:e.initForm}},[d("span",{staticClass:"leading-normal"},[e._v("choisir un média")]),e._v(" "),d("input",{ref:"file_media",staticClass:"hidden",attrs:{type:"file",id:"file_media",accept:e.accept_file},on:{change:function(t){return e.handleFileUploadMedia(t)}}})]),e._v(" "),d("div",{staticClass:"progress progress-media hidden"},[d("div",{staticClass:"progress-title-media"},[e._v(e._s(e.uploadPercentageMedia)+"%")]),e._v(" "),d("div",{staticClass:"progress-stop-media",on:{click:function(t){return e.cancelFileUpload()}}},[e._v("stop")]),e._v(" "),d("div",{staticClass:"progress-bar-media",style:{width:e.uploadPercentageMedia+"%"}})])])])])]),e._v(" "),d("div",{staticClass:"form-bloc"},[d("div",{staticClass:"col w-full"},[d("div",{staticClass:"col-content"},[d("label",{attrs:{for:"legende_media",id:"Llegende_media"}},[e._v("Légende")]),e._v(" "),d("textarea",{directives:[{name:"model",rawName:"v-model",value:e.legende_media,expression:"legende_media"}],attrs:{name:"legende_media",id:"legende_media"},domProps:{value:e.legende_media},on:{focus:e.initForm,input:function(t){t.target.composing||(e.legende_media=t.target.value)}}})])])]),e._v(" "),d("div",{staticClass:"form-action"},[d("div",[d("button",{attrs:{type:"button"},on:{click:function(t){return e.displayMedia()}}},[e._v("Annuler")])]),e._v(" "),d("div",{directives:[{name:"show",rawName:"v-show",value:0!=e.id_document,expression:"id_document != 0"}]},[d("button",{staticClass:"bt-delete",attrs:{type:"button"},on:{click:function(t){return e.delMedia()}}},[e._v("Supprimer")])]),e._v(" "),e._m(0)])])])])])])])])}),[function(){var e=this,t=e.$createElement,d=e._self._c||t;return d("div",[d("button",{attrs:{type:"submit"}},[e._v("Enregistrer")])])}],!1,null,null,null);t.default=component.exports}}]);