(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{415:function(e,t,r){"use strict";var d=r(13),n=r(3),o=r(100),l=r(23),c=r(17),m=r(53),f=r(195),h=r(99),v=r(194),_=r(5),y=r(54),M=r(77).f,w=r(40).f,C=r(22).f,E=r(416).trim,j="Number",O=n.Number,x=O.prototype,L=m(y(x))==j,k=function(e){if(h(e))throw TypeError("Cannot convert a Symbol value to a number");var t,r,d,n,o,l,c,code,m=v(e,"number");if("string"==typeof m&&m.length>2)if(43===(t=(m=E(m)).charCodeAt(0))||45===t){if(88===(r=m.charCodeAt(2))||120===r)return NaN}else if(48===t){switch(m.charCodeAt(1)){case 66:case 98:d=2,n=49;break;case 79:case 111:d=8,n=55;break;default:return+m}for(l=(o=m.slice(2)).length,c=0;c<l;c++)if((code=o.charCodeAt(c))<48||code>n)return NaN;return parseInt(o,d)}return+m};if(o(j,!O(" 0o1")||!O("0b1")||O("+0x1"))){for(var A,S=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof S&&(L?_((function(){x.valueOf.call(r)})):m(r)!=j)?f(new O(k(t)),r,S):k(t)},N=d?M(O):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),I=0;N.length>I;I++)c(O,A=N[I])&&!c(S,A)&&C(S,A,w(O,A));S.prototype=x,x.constructor=S,l(n,j,S)}},416:function(e,t,r){var d=r(27),n=r(14),o="["+r(417)+"]",l=RegExp("^"+o+o+"*"),c=RegExp(o+o+"*$"),m=function(e){return function(t){var r=n(d(t));return 1&e&&(r=r.replace(l,"")),2&e&&(r=r.replace(c,"")),r}};e.exports={start:m(1),end:m(2),trim:m(3)}},417:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},463:function(e,t,r){"use strict";r.r(t);r(26),r(19),r(21),r(38),r(20),r(39);var d=r(11),n=(r(415),r(66),r(47),r(133),r(9),r(64),r(32)),o=r(65),l=r.n(o),c=r(132);function m(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}var f={name:"edit-media",layout:"edit",middleware:"auth",components:{draggable:r.n(c).a},computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(t){Object(d.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(n.b)(["isAuthenticated","loggedInUser"])),created:function(){},mounted:function(){this.getMedias()},data:function(){var e;return e={url_server:this.$store.state.url_server,accept_file:".jpg,.jpeg,.png,.gif,.mp4,.mp3,.pdf",value_file:"",uploadPercentageMedia:0,previewMedia:"",flexIsFile:"",source:this.media_source,id_parent:this.media_id_parent,id_document:0,file_media:""},Object(d.a)(e,"value_file",""),Object(d.a)(e,"embed_media",""),Object(d.a)(e,"poster_media",""),Object(d.a)(e,"autoplay_media",""),Object(d.a)(e,"legende_media",""),Object(d.a)(e,"isNew_media",!1),Object(d.a)(e,"medias",[]),Object(d.a)(e,"media",""),Object(d.a)(e,"isShowLoadingMedias",!0),Object(d.a)(e,"isShowNoResultMedias",!1),e},props:{media_source:String,media_id_parent:Number},methods:{getMedias:function(){var e=this;console.log("p : "+this.id_parent+" / "+this.source),l.a.get(this.url_server+"/getMedias?id_parent="+this.id_parent+"&source="+this.source).then((function(t){e.isShowLoadingMedias=!1,e.medias=t.data.resultat,0==e.medias.length&&(e.isShowNoResultMedias=!0)})).catch((function(e){displayErreur("media loading error")}))},getMedia:function(){var e=this;l.a.get(this.url_server+"/getMedia?id_document="+this.id_document).then((function(t){e.media=t.data.liste,void 0!==e.media.fichier&&(e.value_file=e.media.fichier,e.legende_media=e.media.legende,e.id_display=e.media.id_display,e.display_end_line=e.media.display_end_line,e.getPreviewMedia())})).catch((function(t){e.id_document=0,displayErreur("media loading error")}))},delMedia:function(){var e=this;l.a.get(this.url_server+"/delMedia?id_document="+this.id_document).then((function(t){e.displayMedia(),e.getMedias()})).catch((function(t){e.id_document=0,displayErreur("media deleting error")}))},submitMediaForm:function(){var e=this;clearRequiredModal(),this.hideErreur(),0==this.id_document&&(this.isNew_media=!0);var data={id_document:this.id_document,id_parent:this.id_parent,source:this.source,fichier:this.value_file,embed:this.embed_media,poster:this.poster_media,autoplay:this.autoplay_media,legende:this.legende_media,id_display:this.id_display,display_end_line:this.display_end_line,isNew:this.isNew_media},t=document.querySelectorAll(".modalZone .required_field");[].forEach.call(t,(function(e){""==e.value&&e.classList.add("required")})),""==this.value_file&&document.querySelectorAll(".modalZone .uploadZone-media")[0].classList.add("required"),checkRequiredModal()?displayErreur("The fields indicated are required"):(disabledActionsModal(),l.a.post(this.url_server+"/addMedia",data).then((function(t){e.id_document=t.data.id_document,e.displayMedia(),e.getMedias()})).catch((function(e){enabledActionsModal(),displayErreur("Error adding media : "+e)})))},handleFileUploadMedia:function(e){this.hideErreur();var element=e.currentTarget;this.fileId=element.id,this.file_media=element.files[0],""!=this.file_media&&this.submitMedia()},submitMedia:function(){var e=this;this.uploadPercentageMedia=0;var t=new FormData;t.append("file",this.file_media),document.querySelectorAll(".progress-media")[0].classList.remove("hidden"),document.querySelectorAll(".uploadZone-media")[0].classList.add("hidden"),document.getElementById("file_media").disabled=!0,l.a.post(this.url_server+"/uploadFile",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){var t=parseInt(Math.round(100*e.loaded/e.total));document.querySelectorAll(".progress-title-media")[0].innerHTML=t+"%",this.uploadPercentageMedia=t}.bind(this)}).then((function(t){var r=t.data.isOptimize;document.querySelector("#file_media").value="",e.value_file=t.data.optimizeFile[0],r?(document.querySelectorAll(".progress-title-media")[0].innerHTML="media optimization...",document.querySelectorAll(".progress-stop-media")[0].classList.add("hidden"),e.uploadPercentage=0,setTimeout(function(){var e=this;l.a.get(this.url_server+"/optimizeFile?fichier="+this.value_file).then((function(t){document.querySelectorAll(".progress-title-media")[0].innerHTML="media optimization...",e.getPreviewMedia()})).catch((function(e){return displayErreur("Error during optimization")}))}.bind(e),2e3)):e.getPreviewMedia()})).catch((function(e){e.response.data.message,displayErreur(e.response.data.message),document.querySelectorAll(".progress-media")[0].classList.add("hidden"),document.querySelectorAll(".uploadZone-media")[0].classList.remove("hidden"),document.getElementById("file_media").disabled=!1}))},getModeMedia:function(e,t){var r="";switch(e.toLowerCase().split(".").pop()){case"mp4":r='<video width="100%" height="auto" controls><source src="/upload/'+e+'" type="video/mp4"></video>';break;case"mp3":preview='<audio controls><source src="/upload/'+e+'" type="audio/mpeg"></audio>';break;case"jpg":case"jpeg":case"gif":case"png":r='<img src="/upload/'+e+'" />';break;default:r='<a class="flex" target="blank" href="/upload/'+e+'"><svg xmlns="http://www.w3.org/2000/svg" class="pr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg> preview file</a>',t&&(this.flexIsFile="flex ")}return r},getPreviewMedia:function(){document.querySelectorAll(".progress-title-media")[0].innerHTML="",document.querySelectorAll(".progress-stop-media")[0].classList.remove("hidden"),document.querySelectorAll(".progress-media")[0].classList.add("hidden"),document.querySelectorAll(".uploadZone-media")[0].classList.remove("hidden"),document.getElementById("file_media").disabled=!1;var e=this.value_file;""!=this.value_file&&(this.previewMedia=this.getModeMedia(e,!0))},displayMedia:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=document.querySelectorAll("#defaultModalMedia")[0];t.classList.contains("hidden")?(t.classList.remove("hidden"),t.focus(),this.id_document=e,0!=this.id_document?this.getMedia():(this.value_file="",this.previewMedia="")):(this.value_file="",this.embed_media="",this.poster_media="",this.autoplay_media=0,this.legende_media="",this.isNew_media=!1,this.id_display=0,this.display_end_line=0,t.classList.add("hidden"),this.initForm())},hideErreur:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){hideErreur()})),initForm:function(e){void 0!==e?e.target.classList.contains("required")&&e.target.classList.remove("required"):clearRequiredModal(),enabledActionsModal(),hideErreur()},onEndPosition:function(){var e,data=(e={id_parent:this.source},Object(d.a)(e,"id_parent",this.id_parent),Object(d.a)(e,"list",this.medias),e);l.a.post(this.url_server+"/updateMediaPosition",data).then((function(e){})).catch((function(e){return displayErreur("error updating positions")}))}}},h=f,v=r(10),component=Object(v.a)(h,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"form-bloc form-bloc-list mt-9"},[r("div",{staticClass:"col w-full"},[r("div",{staticClass:"col-content"},[r("label",{staticClass:"mb-3 border-b border-mainColor cursor-pointer",attrs:{for:"AddFile",id:"LAddFile"},on:{click:function(t){e.displayMedia(0),e.hideErreur()}}},[r("div",{staticClass:"pb-2"},[e._v("Medias")]),e._v(" "),r("div",{staticClass:"flex-1 text-right flex justify-end add highlight"},[r("svg",{staticClass:"bi",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}},[r("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"}})])])]),e._v(" "),r("draggable",{staticClass:"media-grid w-full",attrs:{list:e.medias,tag:"div",draggable:".item"},on:{end:e.onEndPosition}},e._l(e.medias,(function(t,d){return r("div",{staticClass:"relative item cursor-pointer",domProps:{innerHTML:e._s(e.getModeMedia(t.fichier))},on:{click:function(r){e.displayMedia(t.id_document),e.hideErreur()}}})})),0)],1)])]),e._v(" "),r("div",{staticClass:"modalZone hidden overflow-y-auto overflow-x-hidden bg-mainBg/50 flex fixed right-0 left-0 top-4 z-50 justify-center items-center md:h-full md:inset-0",attrs:{id:"defaultModalMedia",tabindex:"1"},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.displayMedia(0)}}},[r("div",{staticClass:"relative px-6 w-full max-w-2xl h-full md:h-auto"},[r("div",{staticClass:"relative bg-mainBg p-6 border border-activeColor"},[r("div",{staticClass:"flex justify-between items-start border-b border-mainColor"},[r("h1",[e._v("Média")]),e._v(" "),r("div",{staticClass:"bg-transparent ml-auto inline-flex items-center highlight",attrs:{"data-modal-toggle":"defaultModalMedia"}},[r("svg",{staticClass:"big cursor-pointer",attrs:{fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},on:{click:function(t){return e.displayMedia()}}},[r("path",{attrs:{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"}})])])]),e._v(" "),r("div",[r("div",{staticClass:"form-container w-full border-0 p-0"},[r("form",{attrs:{method:"post",autocomplete:"off"},on:{submit:function(t){return t.preventDefault(),e.submitMediaForm.apply(null,arguments)}}},[r("div",{staticClass:"form-bloc mt-9"},[r("div",{staticClass:"col w-full"},[r("div",{staticClass:"col-content"},[r("div",[r("div",{staticClass:"justify-between align-center",class:e.flexIsFile},[r("div",{staticClass:"previewMediaUpload pb-1 flex items-center  justify-center"},[r("div",{staticClass:"text-sm w-28",domProps:{innerHTML:e._s(e.previewMedia)}})])]),e._v(" "),r("label",{staticClass:"uploadZone-media bt-upload required_field",on:{click:e.initForm}},[r("span",{staticClass:"leading-normal"},[e._v("choisir un média")]),e._v(" "),r("input",{ref:"file_media",staticClass:"hidden",attrs:{type:"file",id:"file_media",accept:e.accept_file},on:{change:function(t){return e.handleFileUploadMedia(t)}}})]),e._v(" "),r("div",{staticClass:"progress progress-media hidden"},[r("div",{staticClass:"progress-title-media"},[e._v(e._s(e.uploadPercentageMedia)+"%")]),e._v(" "),r("div",{staticClass:"progress-stop-media",on:{click:function(t){return e.cancelFileUpload()}}},[e._v("stop")]),e._v(" "),r("div",{staticClass:"progress-bar-media",style:{width:e.uploadPercentageMedia+"%"}})])])])])]),e._v(" "),r("div",{staticClass:"form-bloc"},[r("div",{staticClass:"col w-full"},[r("div",{staticClass:"col-content"},[r("label",{attrs:{for:"legende_media",id:"Llegende_media"}},[e._v("Légende")]),e._v(" "),r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.legende_media,expression:"legende_media"}],attrs:{name:"legende_media",id:"legende_media"},domProps:{value:e.legende_media},on:{focus:e.initForm,input:function(t){t.target.composing||(e.legende_media=t.target.value)}}})])])]),e._v(" "),r("div",{staticClass:"form-action"},[r("div",[r("button",{attrs:{type:"button"},on:{click:function(t){return e.displayMedia()}}},[e._v("Annuler")])]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:0!=e.id_document,expression:"id_document != 0"}]},[r("button",{staticClass:"bt-delete",attrs:{type:"button"},on:{click:function(t){return e.delMedia()}}},[e._v("Supprimer")])]),e._v(" "),e._m(0)])])])])])])])])}),[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("button",{attrs:{type:"submit"}},[e._v("Enregistrer")])])}],!1,null,null,null);t.default=component.exports}}]);